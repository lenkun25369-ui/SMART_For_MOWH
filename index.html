
  <!-- âœ… å®˜æ–¹ SMART on FHIR client -->
  <script src="https://cdn.jsdelivr.net/npm/fhirclient@2.8.6/build/fhir-client.min.js"></script>
</head>

<body>

  <h1>SMART on FHIR Dashboard</h1>

  <h2>Current Patient</h2>
  <pre id="patient">Loading...</pre>

  <h2>Recent Observations</h2>
  <pre id="observations">Loading...</pre>

  <script>
    /**
     * âœ… æ­£ç¢º SMART App åˆå§‹åŒ–ï¼ˆEHR launch å°ˆç”¨ï¼‰
     * âŒ ä¸è¦ç”¨ client = new FHIR.client(...)
     * âœ… ä¸€å®šè¦ç”¨ FHIR.oauth2.ready()
     */
    FHIR.oauth2.ready()
      .then(function (client) {

        // âœ… æ–¹ä¾¿ä½ åœ¨ DevTools çœ‹
        window.client = client;

        console.log("âœ… SMART READY");
        console.log("FHIR server:", client.state.serverUrl);
        console.log("Patient id:", client.patient && client.patient.id);

        const patientBox = document.getElementById("patient");
        const obsBox = document.getElementById("observations");

        // ğŸš¨ Sandbox æ²’æœ‰å‚³ç—…äººæ™‚
        if (!client.patient || !client.patient.id) {
          patientBox.textContent = "Error: Patient is not available";
          obsBox.textContent = "";
          return;
        }

        // 1ï¸âƒ£ è®€å–ç—…äººè³‡æ–™
        client.patient.read().then(function (patient) {
          patientBox.textContent = JSON.stringify(patient, null, 2);
        });

        // 2ï¸âƒ£ æŸ¥è©¢è©²ç—…äººçš„ Observation
        return client.request(
          "Observation?subject=Patient/" + client.patient.id +
          "&_sort=-date&_count=10",
          { pageLimit: 1, flat: true }
        );

      })
      .then(function (observations) {

        if (!observations) return;

        document.getElementById("observations").textContent =
          JSON.stringify(observations, null, 2);

      })
      .catch(function (error) {

        console.error("âŒ SMART ERROR", error);

        document.getElementById("patient").textContent =
          "Error: " + (error.message || error);
      });
  </script>

</body>
</html> -->


<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>SMART on FHIR Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/fhirclient/build/fhir-client.js"></script>
</head>
<body>

<h1>SMART on FHIR Dashboard</h1>

<h2>Current Patient</h2>
<pre id="patient">Loadingâ€¦</pre>

<h2>Recent Observations</h2>
<pre id="obs">Loadingâ€¦</pre>

<script>
  console.log("FULL URL:", window.location.href);

  FHIR.oauth2.ready()
    .then(client => {
      console.log("SMART READY", client);

      return Promise.all([
        client.patient.read(),
        client.request("Observation?patient=" + client.patient.id + "&_count=5")
      ]);
    })
    .then(([patient, observations]) => {
      document.getElementById("patient").textContent =
        JSON.stringify(patient, null, 2);

      document.getElementById("obs").textContent =
        JSON.stringify(observations, null, 2);
    })
    .catch(err => {
      console.error("SMART ERROR", err);
      document.body.innerHTML += `<pre style="color:red">${err}</pre>`;
    });
</script>

</body>
</html>
