<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>SMART on FHIR Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/fhirclient/build/fhir-client.js"></script>
</head>
<body>

<h1>SMART on FHIR Dashboard</h1>

<h2>Current Patient</h2>
<pre id="patient">Loading…</pre>

<h2>Recent Observations</h2>
<pre id="obs">Loading…</pre>

<script>
  console.log("FULL URL:", window.location.href);

  FHIR.oauth2.ready()
    .then(client => {
      console.log("SMART READY", client);

      return Promise.all([
        client.patient.read(),
        client.request("Observation?patient=" + client.patient.id + "&_count=5")
      ]);
    })
    .then(([patient, observations]) => {
      document.getElementById("patient").textContent =
        JSON.stringify(patient, null, 2);

      document.getElementById("obs").textContent =
        JSON.stringify(observations, null, 2);
    })
    .catch(err => {
      console.error("SMART ERROR", err);
      document.body.innerHTML += `<pre style="color:red">${err}</pre>`;
    });
</script>

</body>
</html>
