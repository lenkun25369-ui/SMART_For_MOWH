<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>SMART App (EHR Launch)</title>

  <!-- SMART JS -->
  <script src="https://cdn.jsdelivr.net/npm/fhirclient/build/fhir-client.min.js"></script>
</head>

<body>

<h3>SMART App Ready</h3>
<pre id="out">Loading...</pre>

<script>
FHIR.oauth2.ready()
  .then(client => {

    let info = [];
    info.push("‚úÖ SMART OAuth ready");
    info.push("FHIR Server: " + client.state.serverUrl);

    if (client.user) {
      info.push("User: " + client.user.fhirUser);
    }

    if (!client.patient) {
      info.push("‚ö†Ô∏è No patient context");
      document.getElementById("out").textContent = info.join("\n");
      return;
    }

    info.push("Patient ID: " + client.patient.id);
    document.getElementById("out").textContent = info.join("\n\n");

    // ‚úÖ ËÆÄÂèñÁóÖ‰∫∫Ë≥áÊñô
    return client.patient.read();
  })
  .then(patient => {
    if (patient) {
      document.getElementById("out").textContent +=
        "\n\nüìÑ Patient Resource:\n" +
        JSON.stringify(patient, null, 2);
    }
  })
  .catch(err => {
    document.getElementById("out").textContent =
      "‚ùå SMART error:\n" + err;
  });
</script>

</body>
</html>
